#!/usr/bin/env python3

import sys
import os
import argparse
import json

# discover paths
scriptpath = os.path.dirname(__file__)
modpath = os.path.abspath(os.path.join(scriptpath, os.pardir))
os.chdir(modpath)
sys.path.append(modpath)


def main(args):
    if os.path.isfile(args.config):
        with open(args.config) as f:
            cfg = json.load(f)
    else:
        cfg = None

    import orson
    import orson.view
    app = orson.view.create_app(config=cfg)

    app.run(
        host=args.host,
        port=args.port
    )


if __name__ == "__main__":
    # get commandline parameters and mix everything
    parser = argparse.ArgumentParser(description='Mork calling Orson.')
    parser.add_argument("--host", type=str, default=os.environ.get("HOST", "0.0.0.0"), help="host address")
    parser.add_argument("--port", type=int, default=os.environ.get("PORT", 8008), help="tcp port")
    parser.add_argument("--config", type=str, default=os.environ.get("CONFIG", os.path.join(modpath,"bin/config_dev.json")), help="config file")

    main(parser.parse_args())
