#!/usr/bin/env python3

import sys
import os
import argparse
from flask_wtf.csrf import CSRFProtect

# discover paths
scriptpath = os.path.dirname(__file__)
modpath = os.path.abspath(os.path.join(scriptpath, os.pardir))
os.chdir(modpath)
sys.path.append(modpath)


def main(args):
    import orson.view
    app = orson.view.create_app()
    app.secret_key = 'my_secret_key'
    orson.view.csrf = CSRFProtect(app)
    orson.view.jwks = []

    app.run(
        host=args.host,
        port=args.port,
        debug=True,
        use_reloader=False,
    )


if __name__ == "__main__":
    # get commandline parameters and mix everything
    parser = argparse.ArgumentParser(description='Mork calling Orson.')
    parser.add_argument("--host", type=str, default=os.environ.get("HOST", "0.0.0.0"), help="host address")
    parser.add_argument("--port", type=int, default=os.environ.get("PORT", 8008), help="tcp port")
    parser.add_argument('--pikaurl', type=str, default='amqp://orson:orson@127.0.0.1:8001/%2F', help='rabbitmq url')
    parser.add_argument("--debug", type=bool, default=False, help="output debugging information")

    main(parser.parse_args())
